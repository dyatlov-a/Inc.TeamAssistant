@inject IStringLocalizer<RetroResources> Localizer

<ConfirmDialog @ref="_confirmDialog">
    @Localizer["ConfirmMoveToDiscussing"]
</ConfirmDialog>

<div class="retro-state-panel">
    <Button ButtonMode="ButtonMode.Small" OnClick="OnMoveNext">
        <PlayIcon Size="20px" />
    </Button>
</div>

@code {
    /// <summary>
    /// Retro session.
    /// </summary>
    [Parameter, EditorRequired]
    public RetroSessionDto? Session { get; set; }

    /// <summary>
    /// Start retro action.
    /// </summary>
    [Parameter, EditorRequired]
    public EventCallback StartRetro { get; set; }
    
    /// <summary>
    /// Move to next action.
    /// </summary>
    [Parameter, EditorRequired]
    public EventCallback<Guid> MoveToNext { get; set; }
    
    /// <summary>
    /// Is prioritizing state.
    /// </summary>
    [Parameter, EditorRequired]
    public bool IsPrioritizing { get; set; }
    
    private ConfirmDialog? _confirmDialog;
    private const string PrioritizingState = "Prioritizing";

    private async Task OnMoveNext()
    {
        if (Session is null)
        {
            await StartRetro.InvokeAsync();
            return;
        }
            
        if (Session.State == PrioritizingState && IsPrioritizing)
            if (_confirmDialog is not null && await _confirmDialog.IsConfirmed())
                await MoveToNext.InvokeAsync(Session.Id);
        else 
            await MoveToNext.InvokeAsync(Session.Id);
    }
}