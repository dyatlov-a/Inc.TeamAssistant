@inject IBotService BotService
@inject IStringLocalizer<DashboardResources> Localizer
@inject RequestProcessor RequestProcessor

<div class="team-connector">
    <FormSection
        Title="@_team.TeamName"
        HelpText="@Localizer["ConnectToTeamHelp"].Value"
        AsRows="true">
        <Content>
            <Loading State="_state" Retry="Load">
                <Content>
                    <div class="team-connector__code">
                        @((MarkupString)_team.Code)
                    </div>
                    <div class="team-connector__buttons">
                        <Button
                            ComponentStyle="ComponentStyle.Secondary"
                            ButtonType="ButtonType.Tab"
                            Link="@_team.LinkForConnect">
                            <Content>
                                @Localizer["ConnectToTeamButton"].Value
                            </Content>
                        </Button>
                    </div>
                </Content>
            </Loading>
        </Content>
    </FormSection>
</div>

@code {
    [Parameter, EditorRequired]
    public Guid TeamId { get; set; }

    private LoadingState _state = LoadingState.Done();
    private GetTeamConnectorResult _team = new(string.Empty, string.Empty, string.Empty);
    
    protected override Task OnParametersSetAsync() => Load();
    
    private async Task Load()
    {
        await RequestProcessor.Process(
            () => BotService.GetConnector(TeamId, "000", "9d9d9d"),
            nameof(DashboardTeamConnector),
            r => _team = r,
            s =>
            {
                _state = s;
                StateHasChanged();
            });
    }
}